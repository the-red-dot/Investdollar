<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מחשבון השקעה בדולר - צ'יינג' מול בנק</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts (Rubik) -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Rubik', sans-serif;
            background-color: #f8fafc;
        }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
    </style>
</head>
<body class="text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            // --- Default Constants ---
            const inflationRate = 3.0; 
            const fundAnnualInterest = 3.22; // Updated based on 3.5% Treasury - 0.28% Fee
            const taxRate = 0.25;

            // --- State Variables (with LocalStorage) ---
            const [amount, setAmount] = useState(() => {
                const saved = localStorage.getItem('calc_amount');
                return saved ? Number(saved) : 10000;
            });
            
            const [targetRate, setTargetRate] = useState(() => {
                const saved = localStorage.getItem('calc_targetRate');
                return saved ? Number(saved) : 3.80;
            });

            // Commission Percentages
            const [buyCommission, setBuyCommission] = useState(() => {
                const saved = localStorage.getItem('calc_buyCommission');
                return saved ? Number(saved) : 1.2;
            });

            const [sellCommission, setSellCommission] = useState(() => {
                const saved = localStorage.getItem('calc_sellCommission');
                return saved ? Number(saved) : 1.0;
            });

            const [currentRate, setCurrentRate] = useState(null);
            const [loading, setLoading] = useState(true);
            const [showInterestInfo, setShowInterestInfo] = useState(false);
            
            // --- Save to Local Storage ---
            useEffect(() => { localStorage.setItem('calc_amount', amount); }, [amount]);
            useEffect(() => { localStorage.setItem('calc_targetRate', targetRate); }, [targetRate]);
            useEffect(() => { localStorage.setItem('calc_buyCommission', buyCommission); }, [buyCommission]);
            useEffect(() => { localStorage.setItem('calc_sellCommission', sellCommission); }, [sellCommission]);

            // --- API Fetch ---
            useEffect(() => {
                const fetchRate = async () => {
                    try {
                        const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                        const data = await response.json();
                        const rate = data.rates.ILS;
                        setCurrentRate(rate);
                        
                        if (targetRate < rate) {
                             setTargetRate(Number((rate * 1.1).toFixed(2)));
                        }
                    } catch (error) {
                        console.error("Error fetching rate:", error);
                        setCurrentRate(3.60); // Fallback
                    } finally {
                        setLoading(false);
                    }
                };
                fetchRate();
            }, []);

            // --- Calculations ---
            const rate = currentRate || 3.60;

            // 1. CASH (CHANGE) SCENARIO
            const cashBuyRate = rate * (1 + buyCommission / 100);
            const cashSellRate = targetRate * (1 - sellCommission / 100); 
            
            const dollarsBought = amount / cashBuyRate;
            const cashFinalShekel = dollarsBought * cashSellRate;
            
            const buyingFee = amount - (dollarsBought * rate); 
            const sellingFee = (dollarsBought * targetRate) - cashFinalShekel;
            
            const cashNetProfit = cashFinalShekel - amount;
            const cashPercentReturn = (cashNetProfit / amount) * 100;

            // 2. FUND (BANK) SCENARIO
            const dollarAppreciation = (targetRate - rate) / rate;
            const totalNominalYield = dollarAppreciation + (fundAnnualInterest / 100);
            const fundGrossFinal = amount * (1 + totalNominalYield);
            const fundNominalProfit = fundGrossFinal - amount;
            
            const inflationDeduction = amount * (inflationRate / 100);
            const realProfit = fundNominalProfit - inflationDeduction;
            const taxToPay = realProfit > 0 ? realProfit * taxRate : 0;
            
            const fundFinalShekel = fundGrossFinal - taxToPay;
            const fundNetProfit = fundFinalShekel - amount;
            const fundPercentReturn = (fundNetProfit / amount) * 100;

            // --- Handlers ---
            const formatNIS = (num) => new Intl.NumberFormat('he-IL', { style: 'currency', currency: 'ILS', maximumFractionDigits: 0 }).format(num);
            
            const handleManualBuyRate = (e) => {
                const inputRate = parseFloat(e.target.value);
                if (inputRate && inputRate > 0) {
                    const newComm = ((inputRate / rate) - 1) * 100;
                    setBuyCommission(newComm);
                }
            };

            const handleManualSellRate = (e) => {
                const inputRate = parseFloat(e.target.value);
                if (inputRate && inputRate > 0) {
                    const newComm = (1 - (inputRate / targetRate)) * 100;
                    setSellCommission(newComm);
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-slate-50">
                        <div className="text-center text-slate-500">טוען נתונים...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen p-4 md:p-8 max-w-4xl mx-auto">
                    
                    {/* Header */}
                    <header className="text-center mb-8">
                        <div className="inline-flex items-center justify-center p-3 bg-blue-100 rounded-full mb-4">
                            <i data-lucide="trending-up" className="w-8 h-8 text-blue-600"></i>
                        </div>
                        <h1 className="text-3xl md:text-4xl font-bold text-slate-900 mb-2">מחשבון השקעה בדולר</h1>
                        <p className="text-slate-500 text-lg">
                            שער יציג עדכני: <span className="font-bold text-blue-600">{rate.toFixed(3)} ₪</span>
                        </p>
                    </header>

                    {/* Inputs Section */}
                    <div className="bg-white rounded-2xl shadow-lg p-6 mb-8 border border-slate-100">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div>
                                <label className="block text-sm font-medium text-slate-500 mb-2">סכום להשקעה (בשקלים)</label>
                                <div className="relative">
                                    <input 
                                        type="number" 
                                        value={amount}
                                        onChange={(e) => setAmount(Number(e.target.value))}
                                        className="w-full text-2xl font-bold p-4 bg-slate-50 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:outline-none text-center"
                                    />
                                    <span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">₪</span>
                                </div>
                            </div>

                            <div>
                                <div className="flex justify-between mb-2">
                                    <label className="text-sm font-medium text-slate-500">צפי שער דולר עתידי (יעד)</label>
                                    <span className="text-sm font-bold text-blue-600">{targetRate.toFixed(2)} ₪</span>
                                </div>
                                <input 
                                    type="range" 
                                    min={(rate * 0.9).toFixed(1)} 
                                    max={(rate * 1.5).toFixed(1)} 
                                    step="0.01" 
                                    value={targetRate}
                                    onChange={(e) => setTargetRate(Number(e.target.value))}
                                    className="w-full h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb accent-blue-600"
                                />
                                <div className="flex justify-between text-xs text-slate-400 mt-2">
                                    <span>{(rate * 0.9).toFixed(1)}</span>
                                    <span>נוכחי: {rate.toFixed(2)}</span>
                                    <span>{(rate * 1.5).toFixed(1)}</span>
                                </div>
                            </div>
                        </div>

                        <div className="border-t border-slate-100 pt-6">
                            <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wide mb-4">הגדרות צ'יינג' (מזומן)</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label className="block text-sm text-slate-600 mb-1">באיזה שער המוכר נותן לך לקנות היום?</label>
                                    <div className="relative">
                                        <input 
                                            type="number" 
                                            step="0.001"
                                            value={cashBuyRate.toFixed(3)}
                                            onChange={handleManualBuyRate}
                                            className="w-full p-2 bg-red-50 border border-red-200 rounded-lg text-red-700 font-bold text-center focus:outline-none focus:border-red-500"
                                        />
                                        <span className="absolute left-3 top-1/2 -translate-y-1/2 text-red-300 text-sm">₪</span>
                                    </div>
                                    <p className="text-xs text-slate-400 mt-1">מגלם עמלה של {buyCommission.toFixed(2)}%</p>
                                </div>

                                <div>
                                    <label className="block text-sm text-slate-600 mb-1">באיזה שער הוא יקנה ממך? (ביחס ליעד)</label>
                                    <div className="relative">
                                        <input 
                                            type="number" 
                                            step="0.001"
                                            value={cashSellRate.toFixed(3)}
                                            onChange={handleManualSellRate}
                                            className="w-full p-2 bg-red-50 border border-red-200 rounded-lg text-red-700 font-bold text-center focus:outline-none focus:border-red-500"
                                        />
                                        <span className="absolute left-3 top-1/2 -translate-y-1/2 text-red-300 text-sm">₪</span>
                                    </div>
                                    <p className="text-xs text-slate-400 mt-1">מגלם עמלה של {sellCommission.toFixed(2)}%</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Results Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        
                        {/* Option 1: Cash */}
                        <div className="bg-white rounded-2xl shadow-sm border border-red-100 overflow-hidden relative">
                            <div className="h-2 bg-red-400 w-full"></div>
                            <div className="p-6">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className="p-2 bg-red-50 rounded-lg text-red-500">
                                        <i data-lucide="banknote" className="w-5 h-5"></i>
                                    </div>
                                    <h3 className="text-xl font-bold text-slate-700">מזומן (צ'יינג')</h3>
                                </div>
                                
                                <div className="mb-6">
                                    <span className="text-slate-400 text-sm">רווח נקי משוער</span>
                                    <div className={`text-3xl font-bold ${cashNetProfit > 0 ? 'text-red-500' : 'text-slate-400'}`}>
                                        {formatNIS(cashNetProfit)}
                                    </div>
                                    <div className="text-sm font-medium text-slate-400 mt-1">
                                        {cashPercentReturn.toFixed(2)}% תשואה
                                    </div>
                                </div>

                                <ul className="space-y-2 text-sm text-slate-600 bg-red-50 p-4 rounded-xl">
                                    <li className="flex justify-between">
                                        <span>הפסד בקנייה:</span>
                                        <span className="font-bold text-red-600">-{formatNIS(buyingFee)}</span>
                                    </li>
                                    <li className="flex justify-between border-b border-red-200 pb-2 mb-2">
                                        <span>הפסד במכירה:</span>
                                        <span className="font-bold text-red-600">-{formatNIS(sellingFee)}</span>
                                    </li>
                                    <li className="flex justify-between font-bold">
                                        <span>סה"כ עמלות:</span>
                                        <span>-{formatNIS(buyingFee + sellingFee)}</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        {/* Option 2: Fund (Winner) */}
                        <div className="bg-white rounded-2xl shadow-lg border-2 border-green-500 overflow-hidden relative transform md:-translate-y-2">
                            <div className="absolute top-0 left-0 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-br-lg">
                                מומלץ
                            </div>
                            <div className="p-6">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className="p-2 bg-green-50 rounded-lg text-green-600">
                                        <i data-lucide="trending-up" className="w-5 h-5"></i>
                                    </div>
                                    <h3 className="text-xl font-bold text-slate-800">קרן כספית בבנק</h3>
                                </div>
                                
                                <div className="mb-6">
                                    <span className="text-slate-400 text-sm">רווח נקי משוער</span>
                                    <div className={`text-4xl font-bold ${fundNetProfit > 0 ? 'text-green-600' : 'text-slate-400'}`}>
                                        {formatNIS(fundNetProfit)}
                                    </div>
                                    <div className="text-sm font-medium text-green-500 mt-1">
                                        {fundPercentReturn.toFixed(2)}% תשואה
                                    </div>
                                </div>

                                <ul className="space-y-3 text-sm text-slate-600 bg-green-50 p-4 rounded-xl">
                                    <li className="flex justify-between">
                                        <span>עמלות קנייה/מכירה:</span>
                                        <span className="font-bold text-green-600">0 ₪</span>
                                    </li>
                                    <li className="flex justify-between items-center">
                                        <div className="flex items-center gap-1 cursor-pointer group relative" onClick={() => setShowInterestInfo(!showInterestInfo)}>
                                            <span className="border-b border-green-400 border-dashed">תוספת ריבית (משוער):</span>
                                            <i data-lucide="help-circle" className="w-3 h-3 text-green-600"></i>
                                        </div>
                                        <span className="font-bold text-green-600">+{formatNIS(amount * (fundAnnualInterest/100))}</span>
                                    </li>
                                    
                                    {/* Interest Explanation Dropdown */}
                                    {showInterestInfo && (
                                        <li className="text-xs bg-white p-3 rounded border border-green-200 mt-1 mb-1 shadow-sm animate-in fade-in zoom-in duration-200">
                                            <p className="font-bold mb-2">מאיפה המספר {fundAnnualInterest}%?</p>
                                            <div className="mb-2 space-y-1">
                                                <div className="flex justify-between">
                                                    <span>1. ריבית אג"ח ארה"ב (1Y Treasury):</span>
                                                    <strong>~3.50%</strong>
                                                </div>
                                                <div className="flex justify-between text-red-500">
                                                    <span>2. פחות דמי ניהול קרן:</span>
                                                    <strong>0.28%-</strong>
                                                </div>
                                                <div className="border-t pt-1 mt-1 flex justify-between font-bold text-green-700">
                                                    <span>= תשואה שנתית נטו (צפי):</span>
                                                    <span>~3.22%</span>
                                                </div>
                                            </div>
                                            <a href="https://www.google.com/search?q=US+1+Year+Treasury+Yield" target="_blank" className="text-blue-500 underline flex items-center gap-1 mt-2 hover:text-blue-700">
                                                <i data-lucide="external-link" className="w-3 h-3"></i>
                                                לחץ כאן לצפייה בנתון הריבית העולמי
                                            </a>
                                        </li>
                                    )}

                                    <li className="flex justify-between items-center border-t border-green-200 pt-2 mt-2">
                                        <span className="flex items-center gap-1 text-slate-500">
                                            תשלום מס (25% ריאלי)
                                        </span>
                                        <span className="font-bold text-slate-500">-{formatNIS(taxToPay)}</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    {/* Chart Comparison */}
                    <div className="bg-white p-6 rounded-2xl shadow-sm mb-8">
                        <h4 className="font-bold text-slate-700 mb-4">מה נשאר בכיס בסוף?</h4>
                        <div className="space-y-4">
                            {/* Bar 1 */}
                            <div>
                                <div className="flex justify-between text-sm mb-1">
                                    <span>מזומן</span>
                                    <span className="font-bold">{formatNIS(cashFinalShekel)}</span>
                                </div>
                                <div className="w-full bg-slate-100 rounded-full h-4 overflow-hidden">
                                    <div 
                                        className="bg-red-400 h-4 rounded-full transition-all duration-1000" 
                                        style={{ width: `${Math.max(5, (cashFinalShekel / (Math.max(cashFinalShekel, fundFinalShekel) * 1.1)) * 100)}%` }}
                                    ></div>
                                </div>
                            </div>
                            {/* Bar 2 */}
                            <div>
                                <div className="flex justify-between text-sm mb-1">
                                    <span>קרן כספית</span>
                                    <span className="font-bold text-green-600">{formatNIS(fundFinalShekel)}</span>
                                </div>
                                <div className="w-full bg-slate-100 rounded-full h-4 overflow-hidden">
                                    <div 
                                        className="bg-green-500 h-4 rounded-full transition-all duration-1000" 
                                        style={{ width: `${Math.max(5, (fundFinalShekel / (Math.max(cashFinalShekel, fundFinalShekel) * 1.1)) * 100)}%` }}
                                    ></div>
                                </div>
                            </div>
                        </div>
                        <div className="mt-4 p-3 bg-blue-50 text-blue-800 text-sm rounded-lg text-center font-medium">
                            ההפרש לטובת הבנק: {formatNIS(fundFinalShekel - cashFinalShekel)}
                        </div>
                    </div>

                    {/* Action Section: Funds & Guide */}
                    <div className="bg-slate-800 text-white rounded-2xl p-8 relative overflow-hidden mb-8">
                        <div className="relative z-10">
                            
                            <div className="text-center mb-8">
                                <h2 className="text-2xl font-bold mb-2">אז מה תכל'ס עושים?</h2>
                                <p className="text-slate-300 text-sm">אין צורך לצאת מהבית. הכל קורה באפליקציית הבנק שלך.</p>
                            </div>

                            {/* Fund Options Table */}
                            <div className="bg-slate-900/50 rounded-xl border border-slate-700 mb-8 overflow-hidden">
                                <div className="p-4 bg-slate-700/30 border-b border-slate-700 flex items-center gap-2">
                                    <i data-lucide="list" className="w-5 h-5 text-green-400"></i>
                                    <span className="font-bold">קרנות כספיות דולריות מובילות</span>
                                </div>
                                <div className="divide-y divide-slate-700">
                                    {/* Fund 1 */}
                                    <div className="p-4 flex flex-col sm:flex-row justify-between items-center gap-3 hover:bg-slate-800/50 transition">
                                        <div className="text-center sm:text-right">
                                            <div className="font-bold text-green-400 text-lg">מיטב כספית דולרית</div>
                                            <div className="text-xs text-slate-400">דמי ניהול נמוכים • נזילות יומית</div>
                                        </div>
                                        <div className="flex flex-col items-center">
                                            <span className="text-[10px] text-slate-500 mb-1 uppercase tracking-wider">מספר נייר</span>
                                            <div className="font-mono text-xl font-bold bg-slate-700/80 px-4 py-2 rounded-lg text-white select-all border border-slate-600">
                                                5100672
                                            </div>
                                        </div>
                                    </div>
                                    {/* Fund 2 */}
                                    <div className="p-4 flex flex-col sm:flex-row justify-between items-center gap-3 hover:bg-slate-800/50 transition">
                                        <div className="text-center sm:text-right">
                                            <div className="font-bold text-white">הראל כספית דולרית</div>
                                            <div className="text-xs text-slate-400">חלופה מצוינת מבית הראל</div>
                                        </div>
                                        <div className="flex flex-col items-center">
                                            <div className="font-mono text-lg font-bold text-slate-300 select-all">
                                                5231097
                                            </div>
                                        </div>
                                    </div>
                                    {/* Fund 3 */}
                                    <div className="p-4 flex flex-col sm:flex-row justify-between items-center gap-3 hover:bg-slate-800/50 transition">
                                        <div className="text-center sm:text-right">
                                            <div className="font-bold text-white">אנליסט כספית דולרית</div>
                                            <div className="text-xs text-slate-400">לרוב דמי ניהול אטרקטיביים</div>
                                        </div>
                                        <div className="flex flex-col items-center">
                                            <div className="font-mono text-lg font-bold text-slate-300 select-all">
                                                5138839
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {/* Step by Step Guide */}
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                                <div className="bg-slate-700/30 p-4 rounded-xl border border-slate-700 text-center">
                                    <div className="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-3 font-bold shadow-lg shadow-blue-900/20">1</div>
                                    <p className="text-sm text-slate-200">נכנסים לאפליקציית הבנק ללשונית <br/><span className="font-bold text-blue-300">"שוק ההון"</span> או <span className="font-bold text-blue-300">"השקעות"</span></p>
                                </div>
                                <div className="bg-slate-700/30 p-4 rounded-xl border border-slate-700 text-center">
                                    <div className="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-3 font-bold shadow-lg shadow-blue-900/20">2</div>
                                    <p className="text-sm text-slate-200">לוחצים על זכוכית המגדלת (חיפוש נייר ערך) ומקלידים את <span className="font-bold text-blue-300">מספר הקרן</span></p>
                                </div>
                                <div className="bg-slate-700/30 p-4 rounded-xl border border-slate-700 text-center">
                                    <div className="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-3 font-bold shadow-lg shadow-blue-900/20">3</div>
                                    <p className="text-sm text-slate-200">לוחצים <span className="font-bold text-green-400">"קנייה"</span>, מזינים את הסכום בשקלים ומאשרים</p>
                                </div>
                            </div>

                            {/* Verification Link */}
                            <div className="text-center pt-4 border-t border-slate-700/50">
                                <div className="inline-block">
                                    <a 
                                        href="https://maya.tase.co.il/fund/5100672?view=details" 
                                        target="_blank" 
                                        rel="noopener noreferrer"
                                        className="text-xs text-blue-300 hover:text-white underline flex items-center justify-center gap-1 transition-colors"
                                    >
                                        <i data-lucide="external-link" className="w-3 h-3"></i>
                                        לצפייה בנתוני הקרן הרשמיים באתר הבורסה (מאיה)
                                    </a>
                                </div>
                            </div>

                        </div>
                        
                        {/* Decor */}
                        <div className="absolute top-0 right-0 -mt-10 -mr-10 w-60 h-60 bg-blue-600 rounded-full opacity-10 blur-3xl"></div>
                        <div className="absolute bottom-0 left-0 -mb-10 -ml-10 w-60 h-60 bg-green-600 rounded-full opacity-10 blur-3xl"></div>
                    </div>

                    {/* Disclaimer Footer */}
                    <footer className="text-center border-t border-slate-200 pt-6 pb-8">
                        <div className="bg-orange-50 border border-orange-100 rounded-lg p-4 inline-block max-w-2xl">
                            <div className="flex items-center justify-center gap-2 mb-2 text-orange-600 font-bold">
                                <i data-lucide="alert-triangle" className="w-5 h-5"></i>
                                <span>הבהרה משפטית חשובה</span>
                            </div>
                            <p className="text-sm text-slate-600 leading-relaxed">
                                המידע המוצג באתר זה הינו למטרות אינפורמטיביות והמחשה בלבד ואינו מהווה ייעוץ השקעות, המלצה לפעולה, או תחליף לשיקול דעת אישי וייעוץ מקצועי המותאם לצרכיך. 
                                הנתונים מתבססים על הערכות והנחות שוק המשתנות מעת לעת. ט.ל.ח.
                            </p>
                        </div>
                    </footer>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        lucide.createIcons();
    </script>
</body>
</html>
