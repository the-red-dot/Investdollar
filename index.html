<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מחשבון השקעה בדולר - צ'יינג' מול בנק</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts (Rubik) -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Rubik', sans-serif;
            background-color: #f8fafc;
        }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
    </style>
</head>
<body class="text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            // --- Default Constants ---
            const inflationRate = 3.0; 
            const fundAnnualInterest = 3.5; 
            const taxRate = 0.25;

            // --- State Variables (with LocalStorage) ---
            const [amount, setAmount] = useState(() => {
                const saved = localStorage.getItem('calc_amount');
                return saved ? Number(saved) : 10000;
            });
            
            const [targetRate, setTargetRate] = useState(() => {
                const saved = localStorage.getItem('calc_targetRate');
                return saved ? Number(saved) : 3.80;
            });

            // Commission Percentages (Buying and Selling spreads)
            // We store the % internally, but user edits the Price
            const [buyCommission, setBuyCommission] = useState(() => {
                const saved = localStorage.getItem('calc_buyCommission');
                return saved ? Number(saved) : 1.2;
            });

            const [sellCommission, setSellCommission] = useState(() => {
                const saved = localStorage.getItem('calc_sellCommission');
                return saved ? Number(saved) : 1.0;
            });

            const [currentRate, setCurrentRate] = useState(null);
            const [loading, setLoading] = useState(true);
            
            // --- Save to Local Storage on Change ---
            useEffect(() => { localStorage.setItem('calc_amount', amount); }, [amount]);
            useEffect(() => { localStorage.setItem('calc_targetRate', targetRate); }, [targetRate]);
            useEffect(() => { localStorage.setItem('calc_buyCommission', buyCommission); }, [buyCommission]);
            useEffect(() => { localStorage.setItem('calc_sellCommission', sellCommission); }, [sellCommission]);

            // --- API Fetch ---
            useEffect(() => {
                const fetchRate = async () => {
                    try {
                        const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                        const data = await response.json();
                        const rate = data.rates.ILS;
                        setCurrentRate(rate);
                        
                        // Default target only if not set meaningfully
                        if (targetRate < rate) {
                             setTargetRate(Number((rate * 1.1).toFixed(2)));
                        }
                    } catch (error) {
                        console.error("Error fetching rate:", error);
                        setCurrentRate(3.60); // Fallback
                    } finally {
                        setLoading(false);
                    }
                };
                fetchRate();
            }, []);

            // --- Calculations ---
            const rate = currentRate || 3.60;

            // 1. CASH (CHANGE) SCENARIO
            const cashBuyRate = rate * (1 + buyCommission / 100);
            const cashSellRate = targetRate * (1 - sellCommission / 100); 
            
            const dollarsBought = amount / cashBuyRate;
            const cashFinalShekel = dollarsBought * cashSellRate;
            
            const buyingFee = amount - (dollarsBought * rate); 
            const sellingFee = (dollarsBought * targetRate) - cashFinalShekel;
            
            const cashNetProfit = cashFinalShekel - amount;
            const cashPercentReturn = (cashNetProfit / amount) * 100;

            // 2. FUND (BANK) SCENARIO
            const dollarAppreciation = (targetRate - rate) / rate;
            const totalNominalYield = dollarAppreciation + (fundAnnualInterest / 100);
            const fundGrossFinal = amount * (1 + totalNominalYield);
            const fundNominalProfit = fundGrossFinal - amount;
            
            const inflationDeduction = amount * (inflationRate / 100);
            const realProfit = fundNominalProfit - inflationDeduction;
            const taxToPay = realProfit > 0 ? realProfit * taxRate : 0;
            
            const fundFinalShekel = fundGrossFinal - taxToPay;
            const fundNetProfit = fundFinalShekel - amount;
            const fundPercentReturn = (fundNetProfit / amount) * 100;

            // --- Handlers ---
            const formatNIS = (num) => new Intl.NumberFormat('he-IL', { style: 'currency', currency: 'ILS', maximumFractionDigits: 0 }).format(num);
            
            // Updates commission based on manual price input
            const handleManualBuyRate = (e) => {
                const inputRate = parseFloat(e.target.value);
                if (inputRate && inputRate > 0) {
                    const newComm = ((inputRate / rate) - 1) * 100;
                    setBuyCommission(newComm);
                }
            };

            const handleManualSellRate = (e) => {
                const inputRate = parseFloat(e.target.value);
                if (inputRate && inputRate > 0) {
                    const newComm = (1 - (inputRate / targetRate)) * 100;
                    setSellCommission(newComm);
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-slate-50">
                        <div className="text-center text-slate-500">טוען נתונים...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen p-4 md:p-8 max-w-4xl mx-auto">
                    
                    {/* Simple Header (Old Style) */}
                    <header className="text-center mb-8">
                        <div className="inline-flex items-center justify-center p-3 bg-blue-100 rounded-full mb-4">
                            <i data-lucide="trending-up" className="w-8 h-8 text-blue-600"></i>
                        </div>
                        <h1 className="text-3xl md:text-4xl font-bold text-slate-900 mb-2">מחשבון השקעה בדולר</h1>
                        <p className="text-slate-500 text-lg">
                            שער יציג עדכני: <span className="font-bold text-blue-600">{rate.toFixed(3)} ₪</span>
                        </p>
                    </header>

                    {/* Inputs Section */}
                    <div className="bg-white rounded-2xl shadow-lg p-6 mb-8 border border-slate-100">
                        {/* Primary Inputs */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div>
                                <label className="block text-sm font-medium text-slate-500 mb-2">סכום להשקעה (בשקלים)</label>
                                <div className="relative">
                                    <input 
                                        type="number" 
                                        value={amount}
                                        onChange={(e) => setAmount(Number(e.target.value))}
                                        className="w-full text-2xl font-bold p-4 bg-slate-50 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:outline-none text-center"
                                    />
                                    <span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">₪</span>
                                </div>
                            </div>

                            <div>
                                <div className="flex justify-between mb-2">
                                    <label className="text-sm font-medium text-slate-500">צפי שער דולר עתידי (יעד)</label>
                                    <span className="text-sm font-bold text-blue-600">{targetRate.toFixed(2)} ₪</span>
                                </div>
                                <input 
                                    type="range" 
                                    min={(rate * 0.9).toFixed(1)} 
                                    max={(rate * 1.5).toFixed(1)} 
                                    step="0.01" 
                                    value={targetRate}
                                    onChange={(e) => setTargetRate(Number(e.target.value))}
                                    className="w-full h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb accent-blue-600"
                                />
                                <div className="flex justify-between text-xs text-slate-400 mt-2">
                                    <span>{(rate * 0.9).toFixed(1)}</span>
                                    <span>נוכחי: {rate.toFixed(2)}</span>
                                    <span>{(rate * 1.5).toFixed(1)}</span>
                                </div>
                            </div>
                        </div>

                        {/* Advanced Change Settings (The 2 Lines) */}
                        <div className="border-t border-slate-100 pt-6">
                            <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wide mb-4">הגדרות צ'יינג' (מזומן)</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {/* Buy Rate Config */}
                                <div>
                                    <label className="block text-sm text-slate-600 mb-1">באיזה שער המוכר נותן לך לקנות היום?</label>
                                    <div className="relative">
                                        <input 
                                            type="number" 
                                            step="0.001"
                                            value={cashBuyRate.toFixed(3)}
                                            onChange={handleManualBuyRate}
                                            className="w-full p-2 bg-red-50 border border-red-200 rounded-lg text-red-700 font-bold text-center focus:outline-none focus:border-red-500"
                                        />
                                        <span className="absolute left-3 top-1/2 -translate-y-1/2 text-red-300 text-sm">₪</span>
                                    </div>
                                    <p className="text-xs text-slate-400 mt-1">מגלם עמלה של {buyCommission.toFixed(2)}%</p>
                                </div>

                                {/* Sell Rate Config */}
                                <div>
                                    <label className="block text-sm text-slate-600 mb-1">באיזה שער הוא יקנה ממך? (ביחס ליעד)</label>
                                    <div className="relative">
                                        <input 
                                            type="number" 
                                            step="0.001"
                                            value={cashSellRate.toFixed(3)}
                                            onChange={handleManualSellRate}
                                            className="w-full p-2 bg-red-50 border border-red-200 rounded-lg text-red-700 font-bold text-center focus:outline-none focus:border-red-500"
                                        />
                                        <span className="absolute left-3 top-1/2 -translate-y-1/2 text-red-300 text-sm">₪</span>
                                    </div>
                                    <p className="text-xs text-slate-400 mt-1">מגלם עמלה של {sellCommission.toFixed(2)}%</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Results Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        
                        {/* Option 1: Cash */}
                        <div className="bg-white rounded-2xl shadow-sm border border-red-100 overflow-hidden relative">
                            <div className="h-2 bg-red-400 w-full"></div>
                            <div className="p-6">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className="p-2 bg-red-50 rounded-lg text-red-500">
                                        <i data-lucide="banknote" className="w-5 h-5"></i>
                                    </div>
                                    <h3 className="text-xl font-bold text-slate-700">מזומן (צ'יינג')</h3>
                                </div>
                                
                                <div className="mb-6">
                                    <span className="text-slate-400 text-sm">רווח נקי משוער</span>
                                    <div className={`text-3xl font-bold ${cashNetProfit > 0 ? 'text-red-500' : 'text-slate-400'}`}>
                                        {formatNIS(cashNetProfit)}
                                    </div>
                                    <div className="text-sm font-medium text-slate-400 mt-1">
                                        {cashPercentReturn.toFixed(2)}% תשואה
                                    </div>
                                </div>

                                <ul className="space-y-2 text-sm text-slate-600 bg-red-50 p-4 rounded-xl">
                                    <li className="flex justify-between">
                                        <span>הפסד בקנייה:</span>
                                        <span className="font-bold text-red-600">-{formatNIS(buyingFee)}</span>
                                    </li>
                                    <li className="flex justify-between border-b border-red-200 pb-2 mb-2">
                                        <span>הפסד במכירה:</span>
                                        <span className="font-bold text-red-600">-{formatNIS(sellingFee)}</span>
                                    </li>
                                    <li className="flex justify-between font-bold">
                                        <span>סה"כ עמלות:</span>
                                        <span>-{formatNIS(buyingFee + sellingFee)}</span>
                                    </li>
                                    <li className="flex justify-between mt-2 pt-2 border-t border-red-200/50">
                                        <span>ריבית בנקאית:</span>
                                        <span className="font-bold">0 ₪</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        {/* Option 2: Fund (Winner) */}
                        <div className="bg-white rounded-2xl shadow-lg border-2 border-green-500 overflow-hidden relative transform md:-translate-y-2">
                            <div className="absolute top-0 left-0 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-br-lg">
                                מומלץ
                            </div>
                            <div className="p-6">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className="p-2 bg-green-50 rounded-lg text-green-600">
                                        <i data-lucide="trending-up" className="w-5 h-5"></i>
                                    </div>
                                    <h3 className="text-xl font-bold text-slate-800">קרן כספית בבנק</h3>
                                </div>
                                
                                <div className="mb-6">
                                    <span className="text-slate-400 text-sm">רווח נקי משוער</span>
                                    <div className={`text-4xl font-bold ${fundNetProfit > 0 ? 'text-green-600' : 'text-slate-400'}`}>
                                        {formatNIS(fundNetProfit)}
                                    </div>
                                    <div className="text-sm font-medium text-green-500 mt-1">
                                        {fundPercentReturn.toFixed(2)}% תשואה
                                    </div>
                                </div>

                                <ul className="space-y-3 text-sm text-slate-600 bg-green-50 p-4 rounded-xl">
                                    <li className="flex justify-between">
                                        <span>עמלות קנייה/מכירה:</span>
                                        <span className="font-bold text-green-600">0 ₪</span>
                                    </li>
                                    <li className="flex justify-between">
                                        <span>תוספת ריבית ({fundAnnualInterest}%):</span>
                                        <span className="font-bold text-green-600">+{formatNIS(amount * (fundAnnualInterest/100))}</span>
                                    </li>
                                    <li className="flex justify-between items-center border-t border-green-200 pt-2 mt-2">
                                        <span className="flex items-center gap-1 text-slate-500">
                                            תשלום מס (25% ריאלי)
                                        </span>
                                        <span className="font-bold text-slate-500">-{formatNIS(taxToPay)}</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    {/* Chart Comparison */}
                    <div className="bg-white p-6 rounded-2xl shadow-sm mb-8">
                        <h4 className="font-bold text-slate-700 mb-4">מה נשאר בכיס בסוף?</h4>
                        <div className="space-y-4">
                            {/* Bar 1 */}
                            <div>
                                <div className="flex justify-between text-sm mb-1">
                                    <span>מזומן</span>
                                    <span className="font-bold">{formatNIS(cashFinalShekel)}</span>
                                </div>
                                <div className="w-full bg-slate-100 rounded-full h-4 overflow-hidden">
                                    <div 
                                        className="bg-red-400 h-4 rounded-full transition-all duration-1000" 
                                        style={{ width: `${Math.max(5, (cashFinalShekel / (Math.max(cashFinalShekel, fundFinalShekel) * 1.1)) * 100)}%` }}
                                    ></div>
                                </div>
                            </div>
                            {/* Bar 2 */}
                            <div>
                                <div className="flex justify-between text-sm mb-1">
                                    <span>קרן כספית</span>
                                    <span className="font-bold text-green-600">{formatNIS(fundFinalShekel)}</span>
                                </div>
                                <div className="w-full bg-slate-100 rounded-full h-4 overflow-hidden">
                                    <div 
                                        className="bg-green-500 h-4 rounded-full transition-all duration-1000" 
                                        style={{ width: `${Math.max(5, (fundFinalShekel / (Math.max(cashFinalShekel, fundFinalShekel) * 1.1)) * 100)}%` }}
                                    ></div>
                                </div>
                            </div>
                        </div>
                        <div className="mt-4 p-3 bg-blue-50 text-blue-800 text-sm rounded-lg text-center font-medium">
                            ההפרש לטובת הבנק: {formatNIS(fundFinalShekel - cashFinalShekel)}
                        </div>
                    </div>

                    {/* Action Section */}
                    <div className="bg-slate-800 text-white rounded-2xl p-8 text-center relative overflow-hidden mb-8">
                        <div className="relative z-10">
                            <h2 className="text-2xl font-bold mb-4">הדרך החכמה להשקיע</h2>
                            
                            <div className="inline-flex flex-col items-center bg-slate-700 p-4 rounded-xl border border-slate-600 mb-4">
                                <span className="text-sm text-slate-400 mb-1">מספר קרן לחיפוש בבנק (מיטב)</span>
                                <div className="flex items-center gap-3">
                                    <span className="text-3xl font-mono font-bold tracking-wider text-green-400">5100672</span>
                                </div>
                            </div>
                        </div>
                        
                        {/* Decor */}
                        <div className="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-blue-600 rounded-full opacity-20 blur-3xl"></div>
                        <div className="absolute bottom-0 left-0 -mb-10 -ml-10 w-40 h-40 bg-green-600 rounded-full opacity-20 blur-3xl"></div>
                    </div>

                    {/* Disclaimer Footer */}
                    <footer className="text-center border-t border-slate-200 pt-6 pb-8">
                        <div className="bg-orange-50 border border-orange-100 rounded-lg p-4 inline-block max-w-2xl">
                            <div className="flex items-center justify-center gap-2 mb-2 text-orange-600 font-bold">
                                <i data-lucide="alert-triangle" className="w-5 h-5"></i>
                                <span>הבהרה משפטית חשובה</span>
                            </div>
                            <p className="text-sm text-slate-600 leading-relaxed">
                                המידע המוצג באתר זה הינו למטרות אינפורמטיביות והמחשה בלבד ואינו מהווה ייעוץ השקעות, המלצה לפעולה, או תחליף לשיקול דעת אישי וייעוץ מקצועי המותאם לצרכיך. 
                                הנתונים מתבססים על הערכות והנחות שוק המשתנות מעת לעת (כגון שערי מט"ח, ריביות ומיסוי). 
                                אין בנאמר התחייבות לתשואה כלשהי.
                            </p>
                        </div>
                    </footer>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        lucide.createIcons();
    </script>
</body>
</html>
