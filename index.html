<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מחשבון השקעה בדולר - צ'יינג' מול בנק</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts (Rubik) -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Rubik', sans-serif;
            background-color: #f8fafc;
        }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        .slider-thumb-red::-webkit-slider-thumb {
            background: #ef4444; 
        }
    </style>
</head>
<body class="text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            // --- State Variables ---
            const [amount, setAmount] = useState(10000);
            const [targetRate, setTargetRate] = useState(3.80);
            const [currentRate, setCurrentRate] = useState(null);
            const [changeCommission, setChangeCommission] = useState(1.2); // Percentage margin for change
            const [loading, setLoading] = useState(true);
            const [lastUpdate, setLastUpdate] = useState('');
            
            // --- Constants (Assumptions) ---
            const inflationRate = 3.0; // 3% annual inflation
            const fundAnnualInterest = 3.5; // 3.5% annual interest in fund
            const taxRate = 0.25; // 25% tax on real profit

            // --- API Fetch ---
            useEffect(() => {
                const fetchRate = async () => {
                    try {
                        // Using a public API for USD to ILS rate
                        const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                        const data = await response.json();
                        const rate = data.rates.ILS;
                        
                        setCurrentRate(rate);
                        setLastUpdate(new Date(data.date * 1000).toLocaleDateString('he-IL')); // API usually returns unix timestamp or date string
                        
                        // Set a reasonable target default relative to current
                        if (targetRate === 3.80) { // Only override if untouched default
                             setTargetRate(Number((rate * 1.1).toFixed(2)));
                        }
                    } catch (error) {
                        console.error("Error fetching rate:", error);
                        // Fallback rate if API fails
                        setCurrentRate(3.60); 
                    } finally {
                        setLoading(false);
                    }
                };
                
                fetchRate();
            }, []);

            // --- Calculations ---

            // If loading, show placeholder calculations or wait
            const rate = currentRate || 3.60;

            // 1. CASH (CHANGE) SCENARIO
            // Buying Cash: Rate + Commission %
            const cashBuyRate = rate * (1 + changeCommission / 100);
            const dollarsBought = amount / cashBuyRate;
            
            // Selling Cash: Target Rate - Commission % (Assuming same spread on sell)
            // Note: We use the same commission % derived from the buy rate for the sell side
            const cashSellRate = targetRate * (1 - changeCommission / 100); 
            const cashFinalShekel = dollarsBought * cashSellRate;
            const cashNetProfit = cashFinalShekel - amount;
            const cashPercentReturn = (cashNetProfit / amount) * 100;

            // 2. FUND (BANK) SCENARIO
            // Buying Fund: Close to representative rate (0 commission usually)
            const dollarAppreciation = (targetRate - rate) / rate;
            const totalNominalYield = dollarAppreciation + (fundAnnualInterest / 100);
            const fundGrossFinal = amount * (1 + totalNominalYield);
            const fundNominalProfit = fundGrossFinal - amount;
            
            // Tax Calculation (Real Profit)
            const inflationDeduction = amount * (inflationRate / 100);
            const realProfit = fundNominalProfit - inflationDeduction;
            const taxToPay = realProfit > 0 ? realProfit * taxRate : 0;
            
            const fundFinalShekel = fundGrossFinal - taxToPay;
            const fundNetProfit = fundFinalShekel - amount;
            const fundPercentReturn = (fundNetProfit / amount) * 100;

            // Helper for formatting
            const formatNIS = (num) => new Intl.NumberFormat('he-IL', { style: 'currency', currency: 'ILS', maximumFractionDigits: 0 }).format(num);
            const formatUSD = (num) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 2 }).format(num);

            // Handler for manual rate input in Change
            const handleManualChangeRate = (e) => {
                const inputRate = parseFloat(e.target.value);
                if (inputRate && inputRate > 0) {
                    // Reverse calculate the commission: (InputRate / LiveRate - 1) * 100
                    const impliedCommission = ((inputRate / rate) - 1) * 100;
                    setChangeCommission(impliedCommission);
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-slate-50">
                        <div className="text-center">
                            <div className="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                            <p className="text-slate-500">טוען שער דולר עדכני...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen p-4 md:p-8 max-w-4xl mx-auto">
                    
                    {/* Header with Live Rate */}
                    <header className="text-center mb-8">
                        <div className="inline-flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-full text-sm font-bold mb-4 border border-blue-100 shadow-sm animate-pulse">
                            <span className="relative flex h-3 w-3">
                              <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                              <span className="relative inline-flex rounded-full h-3 w-3 bg-blue-500"></span>
                            </span>
                            שער יציג LIVE: {rate.toFixed(3)} ₪
                        </div>
                        <h1 className="text-3xl md:text-4xl font-bold text-slate-900 mb-2">מחשבון השקעה בדולר</h1>
                        <p className="text-slate-500 text-lg">השוואה בזמן אמת לפי שער עדכני</p>
                    </header>

                    {/* Quick Conversion Calculator Based on Live Rate */}
                    <div className="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-2xl shadow-lg p-6 mb-8 text-white relative overflow-hidden">
                        <div className="relative z-10 flex flex-col md:flex-row items-center justify-between gap-6">
                            <div className="text-center md:text-right">
                                <h2 className="text-xl font-bold mb-1 opacity-90">כמה אקבל היום בצ'יינג'?</h2>
                                <p className="text-sm text-blue-200">לפי השער שהזנת: {cashBuyRate.toFixed(3)} ₪</p>
                            </div>
                            <div className="flex items-center gap-4 bg-white/10 p-4 rounded-xl backdrop-blur-sm border border-white/20">
                                <div className="text-center">
                                    <div className="text-xs text-blue-200 mb-1">אתה משלם</div>
                                    <div className="font-bold text-xl">{formatNIS(amount)}</div>
                                </div>
                                <i data-lucide="arrow-left" className="w-5 h-5 text-white/60"></i>
                                <div className="text-center">
                                    <div className="text-xs text-blue-200 mb-1">אתה מקבל (מזומן)</div>
                                    <div className="font-bold text-2xl text-yellow-300">{formatUSD(dollarsBought)}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Settings & Inputs Section */}
                    <div className="bg-white rounded-2xl shadow-lg p-6 mb-8 border border-slate-100">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                            
                            {/* Investment Amount Input */}
                            <div>
                                <label className="block text-sm font-medium text-slate-500 mb-2">סכום להשקעה (בשקלים)</label>
                                <div className="relative">
                                    <input 
                                        type="number" 
                                        value={amount}
                                        onChange={(e) => setAmount(Number(e.target.value))}
                                        className="w-full text-xl font-bold p-3 bg-slate-50 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:outline-none text-center"
                                    />
                                    <span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">₪</span>
                                </div>
                            </div>

                            {/* Manual Change Rate Input */}
                            <div>
                                <div className="flex justify-between mb-2">
                                    <label className="text-sm font-medium text-slate-500">איזה שער המוכר נתן לך?</label>
                                </div>
                                <div className="relative">
                                    <input 
                                        type="number" 
                                        step="0.01"
                                        value={cashBuyRate.toFixed(3)}
                                        onChange={handleManualChangeRate}
                                        className="w-full text-xl font-bold p-3 bg-slate-50 rounded-xl border-2 border-slate-200 focus:border-red-500 focus:outline-none text-center text-red-600"
                                    />
                                    <span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold">₪</span>
                                </div>
                                <div className="text-xs text-slate-400 mt-2 text-center">
                                    זה מגלם עמלה של {changeCommission.toFixed(2)}% מעל היציג
                                </div>
                            </div>

                            {/* Target Rate Input */}
                            <div>
                                <div className="flex justify-between mb-2">
                                    <label className="text-sm font-medium text-slate-500">צפי שער דולר בעתיד</label>
                                    <span className="text-sm font-bold text-blue-600">{targetRate.toFixed(2)} ₪</span>
                                </div>
                                <input 
                                    type="range" 
                                    min={(rate * 0.8).toFixed(1)} 
                                    max={(rate * 1.5).toFixed(1)} 
                                    step="0.01" 
                                    value={targetRate}
                                    onChange={(e) => setTargetRate(Number(e.target.value))}
                                    className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer slider-thumb accent-blue-600"
                                />
                                <div className="flex justify-between text-xs text-slate-400 mt-2">
                                    <span>{(rate * 0.8).toFixed(1)}</span>
                                    <span>נוכחי: {rate.toFixed(2)}</span>
                                    <span>{(rate * 1.5).toFixed(1)}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Results Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        
                        {/* Option 1: Cash */}
                        <div className="bg-white rounded-2xl shadow-sm border border-red-100 overflow-hidden relative">
                            <div className="h-2 bg-red-400 w-full"></div>
                            <div className="p-6">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className="p-2 bg-red-50 rounded-lg text-red-500">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="12" x="2" y="6" rx="2"/><circle cx="12" cy="12" r="2"/><path d="M6 12h.01M18 12h.01"/></svg>
                                    </div>
                                    <h3 className="text-xl font-bold text-slate-700">מזומן (צ'יינג')</h3>
                                </div>
                                
                                <div className="mb-6">
                                    <span className="text-slate-400 text-sm">רווח נקי משוער</span>
                                    <div className={`text-3xl font-bold ${cashNetProfit > 0 ? 'text-red-500' : 'text-slate-400'}`}>
                                        {formatNIS(cashNetProfit)}
                                    </div>
                                    <div className="text-sm font-medium text-slate-400 mt-1">
                                        {cashPercentReturn.toFixed(2)}% תשואה
                                    </div>
                                </div>

                                <ul className="space-y-3 text-sm text-slate-600 bg-red-50 p-4 rounded-xl">
                                    <li className="flex justify-between">
                                        <span>שער קנייה (לפי קלט):</span>
                                        <span className="font-bold">{cashBuyRate.toFixed(3)} ₪</span>
                                    </li>
                                    <li className="flex justify-between">
                                        <span>עמלת המרה ("הפסד" התחלתי):</span>
                                        <span className="font-bold text-red-600">-{formatNIS(amount - (dollarsBought * rate))}</span>
                                    </li>
                                    <li className="flex justify-between opacity-50">
                                        <span>ריבית שנתית:</span>
                                        <span className="font-bold">0 ₪</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        {/* Option 2: Fund (Winner) */}
                        <div className="bg-white rounded-2xl shadow-lg border-2 border-green-500 overflow-hidden relative transform md:-translate-y-2">
                            <div className="absolute top-0 left-0 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-br-lg">
                                מומלץ
                            </div>
                            <div className="p-6">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className="p-2 bg-green-50 rounded-lg text-green-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                                    </div>
                                    <h3 className="text-xl font-bold text-slate-800">קרן כספית בבנק</h3>
                                </div>
                                
                                <div className="mb-6">
                                    <span className="text-slate-400 text-sm">רווח נקי משוער</span>
                                    <div className={`text-4xl font-bold ${fundNetProfit > 0 ? 'text-green-600' : 'text-slate-400'}`}>
                                        {formatNIS(fundNetProfit)}
                                    </div>
                                    <div className="text-sm font-medium text-green-500 mt-1">
                                        {fundPercentReturn.toFixed(2)}% תשואה
                                    </div>
                                </div>

                                <ul className="space-y-3 text-sm text-slate-600 bg-green-50 p-4 rounded-xl">
                                    <li className="flex justify-between">
                                        <span>שער קנייה (ללא עמלה):</span>
                                        <span className="font-bold">{rate.toFixed(3)} ₪</span>
                                    </li>
                                    <li className="flex justify-between">
                                        <span>תוספת ריבית ({fundAnnualInterest}%):</span>
                                        <span className="font-bold text-green-600">+{formatNIS(amount * (fundAnnualInterest/100))}</span>
                                    </li>
                                    <li className="flex justify-between items-center">
                                        <span className="flex items-center gap-1">
                                            מס רווח הון (25% ריאלי)
                                        </span>
                                        <span className="font-bold text-slate-500">-{formatNIS(taxToPay)}</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    {/* Chart Comparison */}
                    <div className="bg-white p-6 rounded-2xl shadow-sm mb-8">
                        <h4 className="font-bold text-slate-700 mb-4">השוואה ויזואלית (נטו בכיס בסוף התקופה)</h4>
                        <div className="space-y-4">
                            {/* Bar 1 */}
                            <div>
                                <div className="flex justify-between text-sm mb-1">
                                    <span>מזומן</span>
                                    <span className="font-bold">{formatNIS(cashFinalShekel)}</span>
                                </div>
                                <div className="w-full bg-slate-100 rounded-full h-4 overflow-hidden">
                                    <div 
                                        className="bg-red-400 h-4 rounded-full transition-all duration-1000" 
                                        style={{ width: `${Math.max(5, (cashFinalShekel / (Math.max(cashFinalShekel, fundFinalShekel) * 1.1)) * 100)}%` }}
                                    ></div>
                                </div>
                            </div>
                            {/* Bar 2 */}
                            <div>
                                <div className="flex justify-between text-sm mb-1">
                                    <span>קרן כספית</span>
                                    <span className="font-bold text-green-600">{formatNIS(fundFinalShekel)}</span>
                                </div>
                                <div className="w-full bg-slate-100 rounded-full h-4 overflow-hidden">
                                    <div 
                                        className="bg-green-500 h-4 rounded-full transition-all duration-1000" 
                                        style={{ width: `${Math.max(5, (fundFinalShekel / (Math.max(cashFinalShekel, fundFinalShekel) * 1.1)) * 100)}%` }}
                                    ></div>
                                </div>
                            </div>
                        </div>
                        <div className="mt-4 p-3 bg-blue-50 text-blue-800 text-sm rounded-lg text-center font-medium">
                            ההפרש בכיס לטובת הבנק: {formatNIS(fundFinalShekel - cashFinalShekel)}
                        </div>
                    </div>

                    {/* Action Section */}
                    <div className="bg-slate-800 text-white rounded-2xl p-8 text-center relative overflow-hidden">
                        <div className="relative z-10">
                            <h2 className="text-2xl font-bold mb-4">מוכן להשקיע חכם?</h2>
                            <p className="text-slate-300 mb-6">אין צורך ללכת לצ'יינג'. נכנסים לאפליקציית הבנק וקונים את הקרן ללא עמלות.</p>
                            
                            <div className="inline-flex flex-col items-center bg-slate-700 p-4 rounded-xl border border-slate-600">
                                <span className="text-sm text-slate-400 mb-1">מספר הקרן לחיפוש בבנק (מיטב)</span>
                                <div className="flex items-center gap-3">
                                    <span className="text-3xl font-mono font-bold tracking-wider text-green-400">5100672</span>
                                </div>
                            </div>
                            
                            <p className="text-xs text-slate-500 mt-4">*הנתונים הם להמחשה בלבד ואינם מהווים ייעוץ השקעות.</p>
                        </div>
                        
                        {/* Decor */}
                        <div className="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-blue-600 rounded-full opacity-20 blur-3xl"></div>
                        <div className="absolute bottom-0 left-0 -mb-10 -ml-10 w-40 h-40 bg-green-600 rounded-full opacity-20 blur-3xl"></div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
